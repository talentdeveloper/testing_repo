!function(a,b){"use strict";Function.prototype.on=function(){return this.__on__=Array.prototype.slice.call(arguments),this},a.BlkLab=function(){},BlkLab.Utils={generateUUID:function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)})},timeDifference:function(a,b){var c,d,e=6e4,f=60*e,g=24*f,h=30*g,i=365*g,j=a-b;return j<e?(c=Math.round(j/1e3),d=c>1?" seconds ":" second "):j<f?(c=Math.round(j/e),d=c>1?" minutes ":" minute "):j<g?(c=Math.round(j/f),d=c>1?" hours ":" hour "):j<h?(c=Math.round(j/g),d=c>1?" days ":" day "):j<i?(c=Math.round(j/h),d=c>1?" months ":" month "):(c=Math.round(j/i),d=c>1?" years ":" year "),c+d+"ago"},titleCase:function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}},BlkLab.create=function(a,c){if("string"==typeof a){var d=b.createElement(a);for(var e in c)d.setAttribute(e,c[e]);return _$(d)}if("object"==typeof a){for(var f,g=[],h=0;h<arguments.length;h++)f=arguments[h],g.push(BlkLab.create(f[0],f[1]));return g}},BlkLab.DataBind={bound:{},fire:function(a,b){if(this.bound[a]){var c,d=this.bound[a],e=this.bound[a].length;for(c=0;c<e;c++)d[c].call(b)}},on:function(a,b){var c=this.bound;return c[a]?c[a].push(b):(c[a]=[],c[a].push(b)),this},off:function(){}},BlkLab.extend=function(a,b){var c;for(c in b)a&&!1===a.hasOwnProperty(c)&&(a[c]=b[c]);return a},BlkLab.on=function(a,b){var c=_$(a),d=b.__on__;c&&c.on(d,b)},BlkLab.DOM={registry:{},find:function(c){var d;"string"==typeof c?"object"!=typeof c?(d=b.querySelector(c))||(d=b.getElementById(c)):d=c:"object"==typeof c&&(d=c);var e;try{d.parentNode&&(e=_$(d.parentNode))}catch(a){}return BlkLab.extend(d,{parent:e,listeners:{},off:function(b,c){a.removeEventListener?this.removeEventListener(b,c,!1):a.detachEvent&&this.detachEvent("on"+b,c)},on:function(b,c){return this.listeners[b]||(this.listeners[b]=[]),this.listeners[b].push(c),this.off(b,c),a.addEventListener?(this.removeEventListener(b,c,!1),this.addEventListener(b,c,!1)):a.attachEvent&&(this.detachEvent("on"+b,c),this.attachEvent("on"+b,c)),this},css:function(a){if("object"==typeof a){var b;for(b in a)this.style[b]=a[b];return this}return this.style[a]},data:function(a,b){if(a="data-"+a,b)return this.setAttribute(a,b),this;try{return this.getAttribute(a)}catch(a){return null}},blklab:function(a,b){if(a="blklab-"+a,b)return this.setAttribute(a,b),this;try{return this.getAttribute(a)}catch(a){return null}},remove_data:function(a,b,c){return c=c||"data-",this.removeAttribute("data-"+a),this},toggle_class:function(a){return this.classList&&this.classList.toggle(a),this},has_class:function(a){if(this.className){return!!this.className.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))}return!1},add_class:function(a){return this.classList?this.classList.contains(a)||this.classList.toggle(a):this.has_class(a)||(this.className+=" "+a),this},remove_class:function(a){if(this.classList)this.classList.remove(a);else if(this.has_class(a)){var b=new RegExp("(\\s|^)"+a+"(\\s|$)");this.className=this.className.replace(b," ")}return this},preg_remove_class:function(a){try{var b=new RegExp("(\\s|^)"+a+"(\\s|$)");this.className=this.className.replace(b," ").trim()}catch(a){console.error(a)}return this},show:function(a){this.style.display=a?"inline-block":"block"},hide:function(){this.style.display="none"},onfocus:function(a){return this.on("focus",a),this},onblur:function(a){return this.on("blur",a),this},click:function(a){return this.on("click",a),this},change:function(a){return this.contentEditable?this.on("blur",a):this.on("change",a),this},doubleclick:function(a){return this.on("dblclick",a),this},drag:function(a){return this.on("drag",a),this},drop:function(a){return this.on("drop",a),this},dragstart:function(a){return this.on("dragstart",a),this},dragenter:function(a){return this.on("dragenter",a),this},dragover:function(a){return this.on("dragover",a),this},dragleave:function(a){return this.on("dragleave",a),this},dragend:function(a){return this.on("dragend",a),this},typing:function(a){this.on("keyup",a)},enter:function(a){return this.on("keyup",function(b){13==(b.which||b.keyCode)&&a()}),this},over:function(a){return this.on("mouseover",a),this},out:function(a){return this.on("mouseleave",a),this},destroy:function(){try{this.parentNode&&this.parentNode.removeChild(this)}catch(a){}return this},prepend:function(a){var c=this.childNodes;if("[object Array]"===Object.prototype.toString.call(a)){for(var d=b.createDocumentFragment(),e=0;e<a.length;e++)d.appendChild(a[e]);this.insertBefore(d,c[0])}else this.insertBefore(a,c[0])},append:function(a){if("[object Array]"===Object.prototype.toString.call(a)){for(var c=b.createDocumentFragment(),d=0;d<a.length;d++)c.appendChild(a[d]);this.appendChild(c)}else this.appendChild(a)},observe:function(a){this.on("change",a)},bounds:function(){var a,b,c={},d=this.getBoundingClientRect().left,e=this.getBoundingClientRect().top,f=this.getBoundingClientRect().bottom,g=this.getBoundingClientRect().right;return b=this.getBoundingClientRect().width?this.getBoundingClientRect().width:this.offsetWidth,a=this.getBoundingClientRect().height?this.getBoundingClientRect().height:this.offsetHeight,c.x=d,c.y=e,c.h=a,c.w=b,c.b=f,c.r=g,c},get_children:function(){return this.childNodes},children_by_class:function(a){return _$(this.getElementsByClassName(a),"true")},children_by_tag:function(a){return _$(this.getElementsByTagName(a),"true")}}),d},findAll:function(a){var c={},d=-1;c.data=[];var e;if(e="string"==typeof a?b.querySelectorAll(a):a,e.length>0){var f;for(f=0;f<e.length;f++){var g=this.find(e[f]);c.data.push(g)}}return BlkLab.extend(c,{length:c.data.length,on:function(a,b){var d;for(d=0;d<c.data.length;d++)c.data[d].on(a,b)},filter:function(a){return c.data.filter(a)},off:function(a,b){var d;for(d=0;d<c.data.length;d++)c.data[d].off(a,b)},css:function(a){c.data.length>0&&c.data.forEach(function(b,c){b.css(a)})},each:function(a){c.data.length>0&&c.data.forEach(function(b,c){a.call(this,_$(b),c)})},removeAll:function(){c.data.length>0&&c.data.forEach(function(a,b){_$(a).destroy()})},click:function(a){var b;for(b=0;b<c.data.length;b++)c.data[b].on("click",a)},first:function(){return _$(c.data[0])},last:function(){return _$(c.data[c.data.length-1])},next:function(){return d+1<c.data.length?d++:d=0,c.data[d]},prev:function(){return d-1>=0?d--:d=c.data.length-1,c.data[d]},splice:function(a,b){return c.data.splice(a,b)}}),c}},a._$=function(a,b){if("string"==typeof a){var c=a[0],d=a[a.length-1];return"."==c||"["==c&&"]"==d?BlkLab.DOM.findAll(a):BlkLab.DOM.find(a)}return b?BlkLab.DOM.findAll(a):BlkLab.DOM.find(a)}}(window,document),String.prototype.toSlug||(String.prototype.toSlug=function(){return this.toLowerCase().replace(/\s/g,"-").replace(/&/g,"and").replace(/[^\w-]+/g,"").replace(/[-*]+/g,"-").trim()}),Handlebars.registerHelper("select",function(a,b){var c=document.createElement("select");return c.innerHTML=b.fn(this),c.value=a,c.children[c.selectedIndex]&&c.children[c.selectedIndex].setAttribute("selected","selected"),c.innerHTML}),Handlebars.registerHelper("checked",function(a,b){console.log(a,b)}),"mosaiscope"==location.hostname?BlkLab.Config={api_base:"http://api.mosaiscope"}:BlkLab.Config={api_base:"http://104.130.141.92:8080"},function(a,b){"use strict";function c(){}a.XHR=function(){this.http=new XMLHttpRequest,this.callback=null,this.method="GET",this.querystring=null,this.content_type="application/x-www-form-urlencoded",this.upload=null,this.listeners=function(a){var b=Coffea.find(this.http);for(var c in a)"progress"==c?Coffea.find(this.upload).ev(c,a[c]):b.ev(c,a[c])},this.headers=function(a){for(var b in a)this.http.setRequestHeader(b,a[b]);""!==this.content_type&&this.http.setRequestHeader("Content-Type",this.content_type)}},XHR.prototype.call=function(a){var b=this,c=BlkLab.Storage.get("access-token");return new Promise(function(d,e){b.http.open(b.method,a),""!==b.content_type&&b.http.setRequestHeader("Content-Type",b.content_type),c&&b.http.setRequestHeader("x-access-token",c),b.http.onload=function(){200===b.http.status?d(b.http):e(b.http)},b.http.onerror=function(){e(new Error("Network Error"))},b.http.send(b.querystring||null)})},BlkLab.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}},BlkLab.poll=function(a,b,c,d,e){var f=Number(new Date)+(d||2e3);e=e||100,function d(){a()?b():Number(new Date)<f?setTimeout(d,e):c(new Error("timed out for "+a+": "+arguments))}()},BlkLab.once=function(a,b){var c;return function(){return a&&(c=a.apply(b||this,arguments),a=null),c}},BlkLab.get=function(a){var b=a.success,c=a.fail,d=new XHR;return a.dataType?d.content_type=a.dataType:d.content_type="application/json",d.method="GET",d.querystring=a.data,b||c?d.call(a.url).then(b,c):d.call(a.url)},BlkLab.post=function(a){var b=a.success,c=a.fail,d=new XHR;return a.dataType?d.content_type=a.dataType:d.content_type="application/json",d.method="POST",d.querystring=a.data,b||c?d.call(a.url).then(b,c):d.call(a.url)},BlkLab.put=function(a){var b=a.success,c=a.fail,d=new XHR;return a.dataType?d.content_type=a.dataType:d.content_type="application/json",d.method="PUT",d.querystring=a.data,b||c?d.call(a.url).then(b,c):d.call(a.url)},BlkLab.del=function(a){var b=a.success||function(){},c=a.fail||function(){},d=new XHR;return d.method="DELETE",b||c?d.call(a.url).then(b,c):d.call(a.url)},BlkLab.History={type:"push",base:"",callback:function(){},start:function(c){if(this.base=location.protocol+"//"+location.hostname,c&&c.callback&&(this.callback=c.callback,this.callback.call(this)),c&&"hash"==c.type)this.type="hash";else{this.type="push";var d=a.history.pushState;a.history.pushState=function(b){var c=d.apply(a.history,arguments);return"function"==typeof a.history.onpushstate&&a.history.onpushstate({state:b}),c}}b.documentElement.addEventListener("click",this.intercept,!1)},intercept:function(b){var c=Evnt.target(b);if(c.href&&-1!=c.href.indexOf(location.host.replace("www.",""))&&("A"==c.tagName||c.getAttribute("data-href"))&&"_blank"!=c.target&&!c.getAttribute("data-target")){b.stopPropagation(),b.preventDefault();var d=c.href?c.href:c.getAttribute("data-href"),e=d.replace(BlkLab.History.base,"");return location.href.replace(BlkLab.History.base,"")!=e&&("push"==BlkLab.History.type?a.history.pushState("","",e):"hash"==BlkLab.History.type&&(location.hash=e)),BlkLab.History.callback&&BlkLab.History.callback.call(this,e),!1}c.getAttribute("data-href")&&"new"!=c.getAttribute&&(location.href=c.getAttribute("data-href"))}},BlkLab.Storage={has_support:function(){try{return"localStorage"in a&&null!==a.localStorage}catch(a){return!1}},get:function(a){try{return localStorage.getItem(a)}catch(a){return null}},set:function(a,b){try{localStorage.setItem(a,b)}catch(a){return null}},remove:function(a){try{return localStorage.removeItem(a)}catch(a){return null}}},BlkLab.Form={collect:function(a,b){for(var c,d=_$(a),e=d.elements,f={},g=d.elements.length,h=0;h<g;h++)(c=e[h].name)&&(f[c]=e[h].value);return b?JSON.stringify(f):f}},BlkLab.Search=function(a,b){for(var c=[],d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c},BlkLab.Security={secured:[],handle:function(a){}},BlkLab.Messages={},BlkLab.Message=function(a,c){var d=BlkLab.create("aside",{id:"message",class:c});d.innerHTML=a,d.add_class("active"),b.documentElement.append(d);setTimeout(function(){d.remove_class("active"),setTimeout(function(){d.destroy()},500)},5e3)},a.Evnt=new c,Evnt.target=function(b){return b=b||a.event,b.target||b.srcElement},BlkLab.imageProcessor="/api/admin/media",BlkLab.Frontend={},BlkLab.Frontend.Uploader={bytes_uploaded:0,bytes_total:0,previous_bytes_loaded:0,max_file_size:1048576,timer:0,total_file_size:"",uploading:!1,queue:{},cur:1,total:0,cur_total:0,callback:null,progress_bar:"",dialog:null,running:[],table:null,header:null,close:null,urls:{img:BlkLab.imageProcessor+"/images",video:BlkLab.imageProcessor+"/videos",pdf:BlkLab.imageProcessor+"/documents",doc:BlkLab.imageProcessor+"/documents",ppt:BlkLab.imageProcessor+"/documents"},check_type:function(a){return/^(image\/bmp|image\/gif|image\/jpeg|image\/png|image\/tiff)$/i.test(a.type)?BlkLab.Frontend.Uploader.urls.img:/^(video\/mp4|video\/quicktime|video\/x-msvideo|video\/x-ms-wmv)$/i.test(a.type)?BlkLab.Frontend.Uploader.urls.video:"application/pdf"==a.type?BlkLab.Frontend.Uploader.urls.pdf:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==a.type||"application/msword"==a.type?BlkLab.Frontend.Uploader.urls.doc:("application/vnd.ms-powerpoint"==a.type||"application/mspowerpoint"==a.type||"application/powerpoint"==a.type||"application/x-mspowerpoint"==a.type)&&BlkLab.Frontend.Uploader.urls.ppt},seconds_to_time:function(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=Math.floor(a-3600*b-60*c);return b<10&&(b="0"+b),c<10&&(c="0"+c),d<10&&(d="0"+d),b&&(b="00"),b+":"+c+":"+d},bytes_to_size:function(a){var b=["Bytes","KB","MB","GB"];if(0==a)return"n/a";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(a/Math.pow(1024,c)).toFixed(1)+" "+b[c]},add_to_queue:function(a,b){b=b||{},b.uuid=BlkLab.Utils.generateUUID(),b.bytes_loaded=0,b.previous_bytes_loaded=0,BlkLab.Frontend.Uploader.queue[a.name]={file:a,meta:b},BlkLab.Frontend.Uploader.cur_total++},start:function(){BlkLab.Frontend.Uploader.total=BlkLab.Frontend.Uploader.cur_total;var a,b;for(a in BlkLab.Frontend.Uploader.queue){var c=BlkLab.Frontend.Uploader.queue[a];-1==BlkLab.Frontend.Uploader.running.indexOf(c.meta.name)&&(b=BlkLab.Frontend.Uploader.check_type(c.file),b?this.process(c,b):(delete BlkLab.Frontend.Uploader.queue[a],BlkLab.Frontend.Uploader.cur_total--,c.meta.callback&&c.meta.callback()))}},process:function(a,b){BlkLab.Frontend.Uploader.running.push(a.meta.name);var c=new FormData;c.append("files",a.file);var d=new XMLHttpRequest,e=BlkLab.Storage.get("access-token");d.open("POST",b,!0),e&&d.setRequestHeader("x-access-token",e),d.upload.file=a.meta,d.upload.onprogress=BlkLab.Frontend.Uploader.progress,d.addEventListener("load",BlkLab.Frontend.Uploader.load,!1),d.addEventListener("error",BlkLab.Frontend.Uploader.error,!1),d.addEventListener("abort",BlkLab.Frontend.Uploader.abort,!1),d.send(c),BlkLab.Frontend.Uploader.timer=setInterval(BlkLab.Frontend.Uploader.update,300)},update:function(){var a;for(a in BlkLab.Frontend.Uploader.queue){var b=BlkLab.Frontend.Uploader.queue[a].meta,c=b.bytes_uploaded;b.previous_bytes_loaded=c}},progress:function(a){var b=a.target.file;if(a.lengthComputable){b.bytes_uploaded=a.loaded,b.bytes_total=a.total;var c=Math.round(100*a.loaded/a.total);BlkLab.Frontend.Uploader.bytes_to_size(BlkLab.Frontend.Uploader.bytes_uploaded);b.progress_bar&&(b.progress_bar.css({width:c.toString()+"%"}),100==c&&b.row.css({background:"#000000"}))}else delete BlkLab.Frontend.Uploader.queue[b.name],delete BlkLab.Frontend.Uploader.running[b.name],b.callback&&b.callback()},load:function(a){delete BlkLab.Frontend.Uploader.queue[a.target.upload.file.name],delete BlkLab.Frontend.Uploader.running[a.target.upload.file.name],BlkLab.Frontend.Uploader.cur_total--,BlkLab.Frontend.Uploader.finish(a)},finish:function(a){var b=a.target.response,c=JSON.parse(b);0==BlkLab.Frontend.Uploader.cur_total&&clearInterval(BlkLab.Frontend.Uploader.timer),this.uploading=!1,a.target.upload.file.callback&&(c.files?a.target.upload.file.callback(a.target.upload.file,c.files[0]):a.target.upload.file.callback(a.target.upload.file,c))},error:function(a){clearInterval(BlkLab.Frontend.Uploader.timer)},abort:function(a){clearInterval(BlkLab.Frontend.Uploader.timer)}},BlkLab.Uploader={bytes_uploaded:0,bytes_total:0,previous_bytes_loaded:0,max_file_size:1048576,timer:0,total_file_size:"",uploading:!1,queue:{},cur:1,total:0,cur_total:0,callback:null,progress_bar:"",dialog:null,running:[],table:null,header:null,close:null,urls:{img:BlkLab.imageProcessor+"/images/upload",video:BlkLab.imageProcessor+"/videos/upload",pdf:BlkLab.imageProcessor+"/documents/upload",doc:BlkLab.imageProcessor+"/documents/upload",ppt:BlkLab.imageProcessor+"/documents/upload"},check_type:function(a){return/^(image\/bmp|image\/gif|image\/jpeg|image\/png|image\/tiff)$/i.test(a.type)?BlkLab.Uploader.urls.img:/^(video\/mp4|video\/quicktime|video\/x-msvideo|video\/x-ms-wmv)$/i.test(a.type)?BlkLab.Uploader.urls.video:"application/pdf"==a.type?BlkLab.Uploader.urls.pdf:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==a.type||"application/msword"==a.type?BlkLab.Uploader.urls.doc:("application/vnd.ms-powerpoint"==a.type||"application/mspowerpoint"==a.type||"application/powerpoint"==a.type||"application/x-mspowerpoint"==a.type)&&BlkLab.Uploader.urls.ppt},seconds_to_time:function(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=Math.floor(a-3600*b-60*c);return b<10&&(b="0"+b),c<10&&(c="0"+c),d<10&&(d="0"+d),b&&(b="00"),b+":"+c+":"+d},bytes_to_size:function(a){var b=["Bytes","KB","MB","GB"];if(0==a)return"n/a";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(a/Math.pow(1024,c)).toFixed(1)+" "+b[c]},add_to_queue:function(a,b){BlkLab.Uploader.queue[a.name]={file:a,meta:{uuid:BlkLab.Utils.generateUUID(),bytes_loaded:0,previous_bytes_loaded:0,name:a.name,callback:b}},BlkLab.Uploader.cur_total++},start:function(){BlkLab.Uploader.total=BlkLab.Uploader.cur_total,BlkLab.Uploader.table||(BlkLab.Uploader.table=BlkLab.create("div",{class:"table"}),BlkLab.Uploader.header=BlkLab.create("h2",{id:"activity_title"}),BlkLab.Uploader.close=BlkLab.create("div",{id:"close"}),BlkLab.Uploader.close.innerHTML="X",BlkLab.Uploader.table.append(BlkLab.Uploader.header),BlkLab.Uploader.table.append(BlkLab.Uploader.close)),BlkLab.Uploader.close.hide(),BlkLab.Uploader.header.innerHTML="Uploading "+BlkLab.Uploader.total+" of "+BlkLab.Uploader.cur_total+" Files";var a,b,c;for(a in BlkLab.Uploader.queue){var d=BlkLab.Uploader.queue[a];-1==BlkLab.Uploader.running.indexOf(d.meta.name)&&(b=BlkLab.create("div",{class:"row",id:d.meta.uuid}),b.innerHTML='<div class="text">'+a+" | "+this.bytes_to_size(d.file.size)+"</div>",BlkLab.Uploader.table.appendChild(b),d.meta.row=b,c=BlkLab.Uploader.check_type(d.file),c?this.process(d,c):(b.innerHTML+=" Failed!",b.add_class("fail"),delete BlkLab.Uploader.queue[a],BlkLab.Uploader.cur_total--,console.log(BlkLab.Uploader.queue),console.log(BlkLab.Uploader.cur_total)))}if(!this.dialog){var e=this.dialog=new Activity(BlkLab.Uploader.table);BlkLab.Uploader.close.click(function(){e.parentNode.removeChild(e),BlkLab.Uploader.table=null,BlkLab.Uploader.header=null,BlkLab.Uploader.close=null,BlkLab.Uploader.dialog=null})}},process:function(a,b){BlkLab.Uploader.running.push(a.meta.name),a.meta.progress_bar=BlkLab.create("div",{class:"progress_bar",id:a.meta.uuid}),a.meta.row.append(a.meta.progress_bar);var c=new FormData;c.append("files",a.file);var d=new XMLHttpRequest,e=BlkLab.Storage.get("access-token");d.open("POST",b,!0),e&&d.setRequestHeader("x-access-token",e),d.upload.file=a.meta,d.upload.onprogress=BlkLab.Uploader.progress,d.addEventListener("load",BlkLab.Uploader.load,!1),d.addEventListener("error",BlkLab.Uploader.error,!1),d.addEventListener("abort",BlkLab.Uploader.abort,!1),d.send(c),BlkLab.Uploader.timer=setInterval(BlkLab.Uploader.update,300)},update:function(){var a;for(a in BlkLab.Uploader.queue){var b=BlkLab.Uploader.queue[a].meta,c=b.bytes_uploaded;b.previous_bytes_loaded=c}},progress:function(a){var b=a.target.file;if(a.lengthComputable){b.bytes_uploaded=a.loaded,b.bytes_total=a.total;var c=Math.round(100*a.loaded/a.total);BlkLab.Uploader.bytes_to_size(BlkLab.Uploader.bytes_uploaded);b.progress_bar.css({width:c.toString()+"%"}),100==c&&b.row.css({background:"#000000"})}else b.row.innerHTML+=" Failed!",b.row.add_class("fail"),delete BlkLab.Uploader.queue[b.name],delete BlkLab.Uploader.running[b.name]},load:function(a){delete BlkLab.Uploader.queue[a.target.upload.file.name],delete BlkLab.Uploader.running[a.target.upload.file.name],BlkLab.Uploader.cur_total--,BlkLab.Uploader.finish(a)},finish:function(a){var b=a.target.responseText;JSON.stringify(b);0==BlkLab.Uploader.cur_total?(clearInterval(BlkLab.Uploader.timer),BlkLab.Uploader.header.innerHTML="Uploading Complete",BlkLab.Uploader.close.show()):BlkLab.Uploader.header.innerHTML="Uploading "+BlkLab.Uploader.cur_total+" of "+BlkLab.Uploader.total+" Files",this.uploading=!1,a.target.upload.file.callback&&a.target.upload.file.callback(a.target.upload.file)},error:function(a){clearInterval(BlkLab.Uploader.timer)},abort:function(a){clearInterval(BlkLab.Uploader.timer)}},a.Activity=function(a){var c=BlkLab.create("div",{class:"blklab-activity"});return c.append(a),b.documentElement.appendChild(c),c.add_class("open"),c},a.Alert=function(a){var c=BlkLab.create("div",{class:"blklab-msg"});c.innerHTML=a,c.click=function(){c.destroy()},b.documentElement.appendChild(c);var d=setTimeout(function(){clearTimeout(d),c.destroy()},5e3)}}(window,document),BlkLab.dataStore={},window._String="",window._Number=0,window._Boolean=!0,window._ObjectID="",BlkLab.Model=function(a){this.super_={},this._schema={},this.data={},this.url,this.path,this.observers={},this.insert=!0,this.primary,this.state=0},BlkLab.Model.prototype={init:function(a){for(var b in a)this.data[b]=a[b]},on:function(a,b){this.observers[a]||(this.observers[a]=[]),this.observers[a].push(b)},emit:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.observers[a];c&&c.forEach(function(a){a.apply(this,b)})},dispatch:function(a){arguments.splice(0,1)},schema:function(a){var b,c=this,d=Object.keys(a);for(b=0;b<d.length;b++){var e=d[b];if(!1===c._schema.hasOwnProperty(a[e])){c._schema[e]=a[e];var f=a[e].default;c.data[e]=c[e]=f||null}}return c},get:function(a){return a in this.data?this.data[a]:null},set:function(a,b){return this.emit("update",a,b,this.data[a]),this.data[a]=b,this},push:function(a,b){return this.emit("update",a,b,this.data[a]),null!==this.data[a]&&this.data[a].constructor===Array||(this.data[a]=[]),this.data[a].push(b),this},setData:function(a){return this.data=a,this},find:function(a){this.state=1;var b=this,c=this.url;this.path&&(c+=this.path);var b=this,d=a?"/"+a._id:"";return BlkLab.get({url:c+d,data:JSON.stringify(a)}).then(function(a){try{var d=JSON.parse(a.response);b.data=d,BlkLab.dataStore[c]=b.data}catch(a){}},function(a){401==a.status&&BlkLab.Security.handle(a)}).then(function(){return new Promise(function(a,c){a(b)})})},length:function(){return this.data.length},eachKey:function(a){var b,c=Object.keys(this.data),d=c.length;for(b=0;b<d;b++){var e=c[b],f=this.data[e];a.call(this,e,f)}},each:function(a,b){var c=a.length;if(c>1){var d;for(d=0;d<c;d++)b.call(self,a[d],d)}else b.call(self,a)},save:function(a){var b=0==this.state?this.url:this.url+"/"+this.data._id;this.data._id||(b=this.url),this.emit("preCommit",this.data);var c=JSON.stringify(this.data),d={url:b,data:c};return console.log(this.data),1==this.state&&this.data._id?BlkLab.put(d):BlkLab.post(d)},update:function(a){var b=this;return new Promise(function(a,c){a(b)})},del:function(a){if(a){var b=this.url+"/"+a;return BlkLab.del({url:b,dataType:"application/json"})}}},BlkLab.Model.extend=function(a,b){1==arguments.length&&(b=a);var c=function(a){BlkLab.Model.call(this,a)};if(c.prototype=Object.create(BlkLab.Model.prototype),c.prototype.constructor=c,arguments.length>1)for(method in a)!1===c.prototype.hasOwnProperty(method)&&(c.prototype[method]=a[method]);var d=new c(b);return d.init(),d},BlkLab.View=function(){},BlkLab.View.prototype={template:"",init:function(){},title:"Test",sub_title:"Sub",onRender:function(){},model:{},render:function(a,b){var c,d="string"==typeof this.template?Handlebars.compile(this.template):this.template,e=this.model.data||{};if(c=d(e),!a)return c;document.querySelector(a).innerHTML=c,_$("[blklab-model]").each(function(a){var b=_$(a),c=b.blklab("model").split("."),d=BlkLab.Utils.titleCase(c[0])+"Model",e=c[1];b.change(function(a){BlkLab.App[d].set(e,this.value||this.innerHTML)})}),this.onRender.call(this)}},BlkLab.View.extend=function(a){var b=function(){BlkLab.View.call(this)};b.prototype=Object.create(BlkLab.View.prototype),b.prototype.constructor=b;for(method in a)!1===b.prototype.hasOwnProperty(method)&&(b.prototype[method]=a[method]);return b},BlkLab.Controller=function(){},BlkLab.Controller.prototype={actions:null,route:null,render:function(){console.log("base")},refreshActions:function(){var a=this.actions;for(action in a){var b,c={click:'[blklab-click="'+action+'"]',change:'[blklab-change="'+action+'"]',mouseover:'[blklab-over="'+action+'"]',mouseout:'[blklab-out="'+action+'"]',dblclick:'[blklab-dblclick="'+action+'"]',typing:'[blklab-typing="'+action+'"]',drag:'[blklab-drag="'+action+'"]',dragenter:'[blklab-dragenter="'+action+'"]',dragover:'[blklab-dragover="'+action+'"]',drop:'[blklab-drop="'+action+'"]',enter:'[blklab-enter="'+action+'"]',submit:'[blklab-submit="'+action+'"]',focus:'[blklab-focus="'+action+'"]',blur:'[blklab-blur="'+action+'"]'};for(key in c)b=_$(c[key]),b.length>0&&b.on(key,a[action])}}},BlkLab.Controller.extend=function(a){var b=function(){BlkLab.Controller.call(this)};b.prototype=Object.create(BlkLab.Controller.prototype),b.prototype.constructor=b;for(method in a)if("actions"!=method)!1===b.prototype.hasOwnProperty(method)&&(b.prototype[method]=a[method]);else var c=a.actions;var d=new b;return d.actions=c,d.refreshActions(),d},function(a){function b(a){for(var b,c=[],e=0,f=0,g="";null!=(b=m.exec(a));){var h=b[0],i=b[1],j=b.index;if(g+=a.slice(f,j),f=j+h.length,i)g+=i[1];else{g&&(c.push(g),g="");var k=b[2],l=b[3],n=b[4],o=b[5],p=b[6],q=b[7],r="+"===p||"*"===p,s="?"===p||"*"===p,t=k||"/",u=n||o||(q?".*":"[^"+t+"]+?");c.push({name:l||e++,prefix:k||"",delimiter:t,optional:s,repeat:r,pattern:d(u)})}}return f<a.length&&(g+=a.substr(f)),g&&c.push(g),c}function c(a){return a.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function d(a){return a.replace(/([=!:$\/()])/g,"\\$1")}function e(a,b){return a.keys=b,a}function f(a){return a.sensitive?"":"i"}function g(a,b){var c=a.source.match(/\((?!\?)/g);if(c)for(var d=0;d<c.length;d++)b.push({name:d,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e(a,b)}function h(a,b,c){for(var d=[],g=0;g<a.length;g++)d.push(k(a[g],b,c).source);return e(new RegExp("(?:"+d.join("|")+")",f(c)),b)}function i(a,c,d){for(var f=b(a),g=j(f,d),h=0;h<f.length;h++)"string"!=typeof f[h]&&c.push(f[h]);return e(g,c)}function j(a,b){b=b||{};for(var d=b.strict,e=!1!==b.end,g="",h=a[a.length-1],i="string"==typeof h&&/\/$/.test(h),j=0;j<a.length;j++){var k=a[j];if("string"==typeof k)g+=c(k);else{var l=c(k.prefix),m=k.pattern;k.repeat&&(m+="(?:"+l+m+")*"),m=k.optional?l?"(?:"+l+"("+m+"))?":"("+m+")?":l+"("+m+")",g+=m}}return d||(g=(i?g.slice(0,-2):g)+"(?:\\/(?=$))?"),g+=e?"$":d&&i?"":"(?=\\/|$)",new RegExp("^"+g,f(b))}function k(a,b,c){return b=b||[],l(b)?c||(c={}):(c=b,b=[]),a instanceof RegExp?g(a,b,c):l(a)?h(a,b,c):i(a,b,c)}function l(a){return"[object Array]"==Object.prototype.toString.call(a)}var m=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");BlkLab.Router=function(){function b(){var a=f.GET;if(a){var b,c,d,e,g;a.some(function(a){if(d={},c=a.pattern.exec(location.pathname),console.log(c),c){for(b=a.resource,g=parseInt(a.keys.length)+1,e=1;e<g;e++)d[a.keys[e-1].name]=c[e];return!0}return!1}),b?!b.secured||b.secured&&BlkLab.Storage.get("access-token")?b.controller.render.call(b.controller,d):BlkLab.Security.handle():console.log("not found")}}function c(a){for(var b in a)d(b,a[b])}function d(a,b,c){var d=[],e=k(a,d);f.GET.push({pattern:e,resource:b,keys:d})}var e=this,f={GET:[]};this.dispatch=b,this.routes=c,this.load=b,this.get=d,window.onpopstate=a.onpushstate=function(a){"push"==BlkLab.History.type&&e.load(location.pathname),window.onhashchange=function(){"hash"==BlkLab.History.type&&e.load(location.hash.replace("#",""))}}}}(window.history),BlkLab.App={run:function(){BlkLab.App.Router.dispatch()},redirect:function(a){window.history.pushState("","",a)},serialize:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},serializeForm:function(a){var b,c=a.elements,d=c.length,e={};for(b=0;b<d;b++)c[b].name&&(e[c[b].name]=c[b].value);return JSON.stringify(e)},validateForm:function(a){var b,c=a.elements,d=c.length,e=!0;for(b=0;b<d;b++)c[b].name&&c[b].getAttribute("required")&&""===c[b].value.trim()&&(e=!1);return e},lazyLoad:function(){function a(a,b){if(!a.src){var c=new Image,d=a.getAttribute("data-src");c.onload=function(){a.src=d,a.add_class("fade"),b&&b()},c.src=d}}function b(a){var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.top<=(window.innerHeight||document.documentElement.clientHeight)}try{var c=_$(".lazy")}catch(a){}var d=function(){c.each(function(d,e){console.log(d),b(d)&&a(d,function(){c.splice(e,e)})})};d(),_$(window).on("scroll",d)}},BlkLab.App.Router=new BlkLab.Router;